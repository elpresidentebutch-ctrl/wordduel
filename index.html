<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>WordDuel – Founder’s Cut</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    :root {
      --bg: #050816;
      --card: #111827;
      --accent-gold: #ffd700;
      --damage-red: #ff6b6b;
      --text-primary: #f9fafb;
      --text-secondary: #9ca3af;
      --health-bar: #4ade80;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      background: radial-gradient(circle at top, #1f2937 0%, #020617 50%, #000 100%);
      color: var(--text-primary);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #root {
      width: 100%;
      max-width: 480px;
      padding: 1rem;
    }

    .game-card {
      background: rgba(15, 23, 42, 0.95);
      border-radius: 16px;
      border: 1px solid rgba(148, 163, 184, 0.3);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.6);
      padding: 1.5rem;
    }

    .title {
      text-align: center;
      margin-bottom: 1rem;
    }

    .title h1 {
      font-size: 1.8rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
    }

    .subtitle {
      font-size: 0.8rem;
      color: var(--text-secondary);
      margin-top: 0.25rem;
    }

    .players-row {
      display: flex;
      gap: 1rem;
      margin-top: 1rem;
    }

    .player-card {
      flex: 1;
      background: linear-gradient(145deg, #020617 0%, #020617 40%, #111827 100%);
      border-radius: 12px;
      padding: 0.75rem;
      border: 1px solid rgba(148, 163, 184, 0.4);
      position: relative;
    }

    .player-label {
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-size: 0.7rem;
      color: var(--text-secondary);
    }

    .health-bar {
      width: 100%;
      height: 16px;
      background: rgba(255, 255, 255, 0.08);
      border-radius: 999px;
      overflow: hidden;
      position: relative;
    }

    .health-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--health-bar) 0%, #44a08d 100%);
      transition: width 0.4s ease;
      border-radius: 999px;
    }

    .health-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 0.7rem;
      font-weight: 600;
      color: white;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
    }

    .current-word {
      font-size: 2rem;
      font-weight: 800;
      min-height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      letter-spacing: 0.1em;
      color: var(--accent-gold);
      text-shadow: 0 0 20px rgba(255, 215, 0, 0.4);
    }

    .letter-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      justify-content: center;
      min-height: 80px;
    }

    .letter-tile {
      width: 45px;
      height: 45px;
      background: linear-gradient(135deg, #2d3561 0%, #1f2544 100%);
      border: 2px solid #4a5578;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
      color: #e5e7eb;
    }

    .letter-tile.selected {
      transform: translateY(-3px);
      box-shadow: 0 10px 20px rgba(250, 204, 21, 0.4);
      border-color: var(--accent-gold);
      color: var(--accent-gold);
    }

    .timer-circle {
      font-size: 2.2rem;
      font-weight: 800;
      color: var(--accent-gold);
      animation: pulse 1s ease-in-out infinite;
    }

    .timer-circle.urgent {
      color: var(--damage-red);
      animation: urgentPulse 0.5s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    @keyframes urgentPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    .damage-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 3.5rem;
      font-weight: 900;
      color: var(--damage-red);
      animation: damageAnim 1s ease-out forwards;
      pointer-events: none;
      z-index: 1000;
      text-shadow: 0 0 0.5rem rgba(255, 107, 107, 0.8);
    }

    @keyframes damageAnim {
      0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
      50% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
      100% { opacity: 0; transform: translate(-50%, -100%) scale(1); }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    const LETTER_VALUES = {
      'A': 1, 'E': 1, 'I': 1, 'O': 1, 'U': 1,
      'L': 1, 'N': 1, 'S': 1, 'T': 1, 'R': 1,
      'D': 2, 'G': 2,
      'B': 3, 'C': 3, 'M': 3, 'P': 3,
      'F': 4, 'H': 4, 'V': 4, 'W': 4, 'Y': 4,
      'K': 5,
      'J': 8, 'X': 8,
      'Q': 10, 'Z': 10
    };

    const LETTER_DISTRIBUTION =
      "AAAAAAAAAEEEEEEEEEEEIIIIIIIIIOOOOOOOOUUUULLLLNNNNSSSSTTTRRRRRDDGGBBCCMMPPFFVVVVYYKKJXQZ";

    const VALID_WORDS = new Set([
      'CAT','DOG','WORD','DUEL','GAME','PLAY',
      'WIN','LOSE','FIGHT','BATTLE',
      'SWORD','SHIELD','MAGIC','POWER',
      'QUEST','HERO','DRAGON','CASTLE',
      'KNIGHT','THE','AND','FOR','ARE',
      'BUT','NOT','YOU','ALL','CAN','HER',
      'WAS','ONE','OUR','OUT','DAY','GET',
      'HAS','HIM','HI','JW','MAN','NEW',
      'NOW','OLD','SEE','TWO','WAY',
      'WHO','BOY','DID','ITS','LET','PUT',
      'SAY','SHE','TOO','USE'
    ]);

    function generateLetters() {
      const letters = [];
      for (let i = 0; i < 12; i++) {
        const randomLetter =
          LETTER_DISTRIBUTION[Math.floor(Math.random() * LETTER_DISTRIBUTION.length)];
        letters.push(randomLetter);
      }
      return letters;
    }

    function calculateWordDamage(word) {
      let damage = 0;
      for (let letter of word) {
        damage += LETTER_VALUES[letter] || 0;
      }
      if (word.length >= 5) damage += 10;
      if (word.length >= 7) damage += 20;
      return damage;
    }

    function getTierFromTrophies(trophies) {
      if (trophies >= 2500) return 'historic';
      if (trophies >= 1500) return 'platinum';
      if (trophies >= 800) return 'gold';
      if (trophies >= 300) return 'silver';
      return 'bronze';
    }

    function pickBestWordFromRack(letters) {
      const letterCounts = {};
      for (const l of letters) {
        letterCounts[l] = (letterCounts[l] || 0) + 1;
      }

      let bestWord = "";
      let bestDamage = 0;

      for (const word of VALID_WORDS) {
        if (word.length > letters.length) continue;
        const tempCounts = { ...letterCounts };
        let ok = true;
        for (const ch of word) {
          if (!tempCounts[ch]) { ok = false; break; }
          tempCounts[ch]--;
        }
        if (!ok) continue;
        const dmg = calculateWordDamage(word);
        if (dmg > bestDamage) {
          bestDamage = dmg;
          bestWord = word;
        }
      }

      return bestWord || "";
    }

    function WordDuelApp() {
      const [screen, setScreen] = useState('title');
      const [trophies, setTrophies] = useState(0);
      const [playerTier, setPlayerTier] = useState('bronze');
      const [round, setRound] = useState(1);
      const [playerWins, setPlayerWins] = useState(0);
      const [opponentWins, setOpponentWins] = useState(0);
      const [playerHealth, setPlayerHealth] = useState(100);
      const [opponentHealth, setOpponentHealth] = useState(100);
      const [playerLetters, setPlayerLetters] = useState([]);
      const [opponentLetters, setOpponentLetters] = useState([]);
      const [selectedLetters, setSelectedLetters] = useState([]);
      const [currentWord, setCurrentWord] = useState("");
      const [timeRemaining, setTimeRemaining] = useState(60);
      const [gameActive, setGameActive] = useState(false);
      const [damagePopup, setDamagePopup] = useState(null);

      useEffect(() => {
        const tier = getTierFromTrophies(trophies);
        setPlayerTier(tier);
      }, [trophies]);

      useEffect(() => {
        if (gameActive && timeRemaining > 0) {
          const timer = setTimeout(() => {
            setTimeRemaining((t) => t - 1);
          }, 1000);
          return () => clearTimeout(timer);
        } else if (timeRemaining === 0 && gameActive) {
          endRound();
        }
      }, [timeRemaining, gameActive]);

      function resetRoundState() {
        setPlayerLetters(generateLetters());
        setOpponentLetters(generateLetters());
        setSelectedLetters([]);
        setCurrentWord("");
        setTimeRemaining(60);
        setGameActive(true);
      }

      function startMatch() {
        setScreen('game');
        setRound(1);
        setPlayerWins(0);
        setOpponentWins(0);
        setPlayerHealth(100);
        setOpponentHealth(100);
        resetRoundState();
      }

      function handleTileClick(index) {
        if (!gameActive) return;
        const letter = playerLetters[index];
        if (!letter) return;

        const newLetters = [...playerLetters];
        newLetters.splice(index, 1);
        setPlayerLetters(newLetters);

        const newSelected = [...selectedLetters, letter];
        setSelectedLetters(newSelected);
        setCurrentWord(newSelected.join(""));
      }

      function clearWord() {
        setPlayerLetters([...playerLetters, ...selectedLetters]);
        setSelectedLetters([]);
        setCurrentWord("");
      }

      function submitWord() {
        if (!gameActive) return;
        const word = currentWord.toUpperCase();
        if (!word || !VALID_WORDS.has(word)) {
          return;
        }

        const playerDamage = calculateWordDamage(word);
        const aiWord = pickBestWordFromRack(opponentLetters);
        const opponentDamage = aiWord ? calculateWordDamage(aiWord) : 0;

        setDamagePopup(`-${playerDamage} / -${opponentDamage}`);
        setTimeout(() => setDamagePopup(null), 1000);

        setOpponentHealth((h) => Math.max(0, h - playerDamage));
        setPlayerHealth((h) => Math.max(0, h - opponentDamage));

        setGameActive(false);
        setTimeout(() => {
          endRound();
        }, 800);
      }

      function endRound() {
        let newPlayerWins = playerWins;
        let newOpponentWins = opponentWins;

        if (playerHealth > opponentHealth) {
          newPlayerWins += 1;
          setPlayerWins(newPlayerWins);
          setTrophies((t) => t + 50);
        } else if (opponentHealth > playerHealth) {
          newOpponentWins += 1;
          setOpponentWins(newOpponentWins);
          setTrophies((t) => Math.max(0, t - 30));
        }

        if (newPlayerWins >= 2 || newOpponentWins >= 2) {
          setGameActive(false);
          setScreen('results');
          return;
        }

        setRound((r) => r + 1);
        setPlayerHealth(100);
        setOpponentHealth(100);
        resetRoundState();
      }

      function backToTitle() {
        setScreen('title');
      }

      const timerUrgent = timeRemaining <= 10;

      if (screen === 'title') {
        return (
          <div className="game-card title-screen">
            <h1>WORDDUEL</h1>
            <p>Build the strongest word from your 12 letters. Out‑damage your opponent. Win the duel.</p>
            <div style={{ marginBottom: '1rem', fontSize: '0.85rem', color: 'var(--text-secondary)' }}>
              Trophies: {trophies} · Tier: {playerTier.toUpperCase()}
            </div>
            <button className="btn" onClick={startMatch}>Start Match</button>
          </div>
        );
      }

      if (screen === 'results') {
        const result =
          playerWins > opponentWins ? "You won the match!" :
          opponentWins > playerWins ? "You lost the match." :
          "Match ended.";

        return (
          <div className="game-card">
            <div className="title">
              <h1>RESULTS</h1>
              <div className="subtitle">
                Trophies: {trophies} · Tier: {playerTier.toUpperCase()}
              </div>
            </div>
            <div className="results">
              <p>{result}</p>
              <p style={{ marginTop: '0.5rem' }}>
                Rounds: You {playerWins} – {opponentWins} Opponent
              </p>
            </div>
            <div className="word-actions" style={{ marginTop: '1.5rem' }}>
              <button className="btn-secondary btn" onClick={backToTitle}>Back to Title</button>
              <button className="btn" onClick={startMatch}>Play Again</button>
            </div>
          </div>
        );
      }

      return (
        <div className="game-card">
          <div className="title">
            <h1>WORDDUEL</h1>
            <div className="subtitle">
              Round {round} · You {playerWins} – {opponentWins} Opponent · Trophies: {trophies}
            </div>
          </div>

          <div className="players-row">
            <div className="player-card">
              <div className="player-label">You</div>
              <div className="health-bar">
                <div className="health-fill" style={{ width: playerHealth + '%' }} />
                <div className="
